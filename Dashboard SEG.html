<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Incidentes | Seguridad CJB</title>
    <meta name="description"
        content="Dashboard interactivo de incidentes de seguridad para Ciudad Juan Bosch - Experiencia Power BI">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>

    <!-- Papa Parse for CSV -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <!-- SheetJS for Excel Export -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    <!-- html2pdf for PDF Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <!-- PDF.js for PDF Text Extraction -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>

    <!-- Configuration -->
    <script src="config.js"></script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="logo-cjb.png" alt="Logo CJB" class="logo">
            <h2>SEGURIDAD CJB</h2>
            <span class="subtitle">Ciudad Juan Bosch</span>
        </div>

        <nav class="sidebar-nav">
            <a href="#" class="nav-item active" data-section="dashboard" data-page="dashboardPage">
                <i class="fas fa-chart-pie"></i>
                <span>Dashboard</span>
            </a>
            <a href="#" class="nav-item" data-section="incidents" data-page="incidentsPage">
                <i class="fas fa-file-alt"></i>
                <span>Incidentes</span>
            </a>
            <a href="#" class="nav-item" data-section="analytics" data-page="analyticsPage">
                <i class="fas fa-chart-line"></i>
                <span>An√°lisis Avanzado</span>
            </a>
            <a href="#" class="nav-item" data-section="reports" data-page="reportsPage">
                <i class="fas fa-file-pdf"></i>
                <span>Reportes</span>
            </a>
            <a href="#" class="nav-item" data-section="history" data-page="historyPage">
                <i class="fas fa-history"></i>
                <span>Hist√≥rico</span>
            </a>
        </nav>

        <div class="sidebar-footer">
            <div class="data-status" id="dataStatus">
                <i class="fas fa-database"></i>
                <span>Sin datos cargados</span>
            </div>
            <button class="btn btn-primary btn-sidebar-upload" id="btnSidebarUpload" onclick="showUploadSection()">
                <i class="fas fa-cloud-upload-alt"></i> Cargar Archivo
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="header">
            <button class="menu-toggle" id="menuToggle">
                <i class="fas fa-bars"></i>
            </button>
            <div class="header-title">
                <h1 id="pageTitle">Dashboard de Incidentes de Seguridad</h1>
                <p class="header-subtitle" id="pageSubtitle">Direcci√≥n de Seguridad - Ciudad Juan Bosch</p>
            </div>
            <div class="header-actions">
                <!-- Active Filters Indicator -->
                <div class="active-filters-badge" id="activeFiltersBadge" style="display: none;">
                    <i class="fas fa-filter"></i>
                    <span id="activeFiltersCount">0</span> filtros activos
                    <button class="clear-filters-btn" id="btnClearAllFilters" title="Limpiar todos los filtros">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <button class="btn btn-export" id="btnExportExcel" disabled>
                    <i class="fas fa-file-excel"></i> <span>Excel</span>
                </button>
                <button class="btn btn-export" id="btnExportPDF" disabled>
                    <i class="fas fa-file-pdf"></i> <span>PDF</span>
                </button>
            </div>
        </header>

        <!-- Upload Section (shown when no data) -->
        <section class="upload-section page-section" id="uploadSection">
            <div class="upload-container">
                <div class="upload-zone" id="uploadZone">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <h3>Cargar Archivo de Incidentes</h3>
                    <p>Arrastra y suelta tu archivo CSV/Excel aqu√≠</p>
                    <span class="upload-or">o</span>
                    <label class="btn btn-primary upload-btn">
                        <i class="fas fa-folder-open"></i> Seleccionar Archivo
                        <input type="file" id="fileInput" accept=".csv,.xlsx,.xls" hidden>
                    </label>
                    <p class="upload-hint">Formatos soportados: CSV, Excel (.xlsx, .xls)</p>
                </div>
            </div>
        </section>

        <!-- ================== DASHBOARD PAGE ================== -->
        <section class="page-section" id="dashboardPage" style="display: none;">
            <div class="dashboard-section">

                <!-- Cross-Filter Bar -->
                <div class="cross-filter-bar" id="crossFilterBar">
                    <div class="filter-info">
                        <i class="fas fa-info-circle"></i>
                        <span>üí° <strong>Tip:</strong> Haz clic en cualquier gr√°fica para filtrar todos los datos
                            autom√°ticamente</span>
                    </div>
                    <div class="active-cross-filters" id="activeCrossFilters"></div>
                </div>

                <!-- Filters Bar -->
                <div class="filters-bar">
                    <div class="filter-group">
                        <label><i class="fas fa-calendar"></i> Desde:</label>
                        <input type="date" id="filterDateFrom" class="filter-input">
                    </div>
                    <div class="filter-group">
                        <label><i class="fas fa-calendar"></i> Hasta:</label>
                        <input type="date" id="filterDateTo" class="filter-input">
                    </div>
                    <div class="filter-group">
                        <label><i class="fas fa-tag"></i> Tipo:</label>
                        <select id="filterType" class="filter-input">
                            <option value="">Todos los tipos</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label><i class="fas fa-map-marker-alt"></i> Cuadrante:</label>
                        <select id="filterQuadrant" class="filter-input">
                            <option value="">Todos</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label><i class="fas fa-user-shield"></i> Oficial:</label>
                        <select id="filterOfficer" class="filter-input">
                            <option value="">Todos</option>
                        </select>
                    </div>
                    <button class="btn btn-danger" id="btnClearFilters">
                        <i class="fas fa-times-circle"></i> Limpiar Filtros
                    </button>
                    <button class="btn btn-primary" id="btnNewFile">
                        <i class="fas fa-upload"></i> Nuevo Archivo
                    </button>
                </div>

                <!-- KPI Cards Row -->
                <div class="kpi-row" id="kpiRow">
                    <div class="kpi-card kpi-primary clickable-kpi" data-kpi="total">
                        <div class="kpi-icon">
                            <i class="fas fa-clipboard-list"></i>
                        </div>
                        <div class="kpi-content">
                            <span class="kpi-value" id="kpiTotalIncidents">0</span>
                            <span class="kpi-label">Total Incidentes</span>
                        </div>
                        <div class="kpi-trend" id="kpiTotalTrend"></div>
                    </div>
                    <div class="kpi-card kpi-warning clickable-kpi" data-kpi="undocumented">
                        <div class="kpi-icon">
                            <i class="fas fa-user-slash"></i>
                        </div>
                        <div class="kpi-content">
                            <span class="kpi-value" id="kpiUndocumented">0</span>
                            <span class="kpi-label">Indocumentados Detenidos</span>
                        </div>
                    </div>
                    <div class="kpi-card kpi-danger clickable-kpi" data-kpi="accidents">
                        <div class="kpi-icon">
                            <i class="fas fa-car-crash"></i>
                        </div>
                        <div class="kpi-content">
                            <span class="kpi-value" id="kpiAccidents">0</span>
                            <span class="kpi-label">Accidentes Tr√°nsito</span>
                        </div>
                    </div>
                    <div class="kpi-card kpi-success clickable-kpi" data-kpi="arrests">
                        <div class="kpi-icon">
                            <i class="fas fa-handcuffs"></i>
                        </div>
                        <div class="kpi-content">
                            <span class="kpi-value" id="kpiArrests">0</span>
                            <span class="kpi-label">Arrestos Realizados</span>
                        </div>
                    </div>
                    <div class="kpi-card kpi-info clickable-kpi" data-kpi="officers">
                        <div class="kpi-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="kpi-content">
                            <span class="kpi-value" id="kpiOfficers">0</span>
                            <span class="kpi-label">Oficiales Activos</span>
                        </div>
                    </div>
                    <div class="kpi-card kpi-purple clickable-kpi" data-kpi="closures">
                        <div class="kpi-icon">
                            <i class="fas fa-store-slash"></i>
                        </div>
                        <div class="kpi-content">
                            <span class="kpi-value" id="kpiClosures">0</span>
                            <span class="kpi-label">Clausuras</span>
                        </div>
                    </div>
                    <!-- Historical Data KPI Cards -->
                    <div class="kpi-card kpi-danger" data-kpi="multas-hist"
                        title="Datos extra√≠dos de reportes PDF hist√≥ricos (Jul-Dic 2025)">
                        <div class="kpi-icon">
                            <i class="fas fa-ticket-alt"></i>
                        </div>
                        <div class="kpi-content">
                            <span class="kpi-value" id="kpiMultasHist">0</span>
                            <span class="kpi-label">Multas (Hist√≥rico)</span>
                        </div>
                    </div>
                    <div class="kpi-card kpi-info" data-kpi="llamadas-hist"
                        title="Datos extra√≠dos de reportes PDF hist√≥ricos (Jul-Dic 2025)">
                        <div class="kpi-icon">
                            <i class="fas fa-phone"></i>
                        </div>
                        <div class="kpi-content">
                            <span class="kpi-value" id="kpiLlamadasHist">0</span>
                            <span class="kpi-label">Llamadas (Hist√≥rico)</span>
                        </div>
                    </div>
                    <div class="kpi-card kpi-success" data-kpi="asistencias-hist"
                        title="Datos extra√≠dos de reportes PDF hist√≥ricos (Jul-Dic 2025)">
                        <div class="kpi-icon">
                            <i class="fas fa-hands-helping"></i>
                        </div>
                        <div class="kpi-content">
                            <span class="kpi-value" id="kpiAsistenciasHist">0</span>
                            <span class="kpi-label">Asistencias (Hist√≥rico)</span>
                        </div>
                    </div>
                </div>

                <!-- Historical Data Info Note -->
                <div class="historical-info-note">
                    <i class="fas fa-info-circle"></i>
                    <span><strong>Nota:</strong> Las tarjetas y gr√°ficos marcados como "Hist√≥rico" muestran datos
                        extra√≠dos de los reportes PDF semanales (Jul-Dic 2025).
                        Para m√°s detalles, visite la secci√≥n <a href="#"
                            onclick="Navigation.navigateTo('historyPage'); return false;"><i class="fas fa-history"></i>
                            Hist√≥rico</a>.</span>
                </div>

                <!-- Interactive Security Map Section -->
                <div class="security-map-section">
                    <div class="chart-card chart-full">
                        <div class="chart-header">
                            <h3><i class="fas fa-map-marked-alt"></i> Mapa de Seguridad - Cuadrantes CJB</h3>
                            <span class="map-legend">
                                <span class="legend-item"><span class="legend-color" style="background:#e74c3c;"></span>
                                    B1</span>
                                <span class="legend-item"><span class="legend-color" style="background:#2ecc71;"></span>
                                    B2</span>
                                <span class="legend-item"><span class="legend-color" style="background:#f1c40f;"></span>
                                    B3</span>
                                <span class="legend-item"><span class="legend-color" style="background:#3498db;"></span>
                                    B4</span>
                            </span>
                        </div>
                        <p class="chart-description">üó∫Ô∏è <strong>Interactivo:</strong> Haga clic en cualquier bot√≥n de
                            cuadrante (B1, B2, B3, B4) para ver estad√≠sticas en el panel lateral.</p>

                        <!-- Flex layout: 3 Columns (Panels Left - Map - Panels Right) -->
                        <div class="map-layout-container">

                            <!-- Left Panels Column (B1 & B3) -->
                            <div class="panels-column left-column">
                                <!-- Panel B1 -->
                                <div class="quadrant-info-panel" id="panel-B1" style="display:none;">
                                    <div class="info-panel-header">
                                        <span class="panel-quadrant-badge" style="background:#e74c3c;">B1</span>
                                        <button class="panel-close" onclick="closeSpecificPanel('B1')">&times;</button>
                                    </div>
                                    <div class="info-panel-content">
                                        <div class="info-row">
                                            <div class="info-stat-compact">
                                                <div><i class="fas fa-exclamation-triangle"></i> Incidentes</div>
                                                <span class="stat-val" id="stat-incidents-B1">0</span>
                                            </div>
                                            <div class="info-stat-compact">
                                                <div><i class="fas fa-user-slash"></i> Indocumentados</div>
                                                <span class="stat-val" id="stat-undoc-B1">0</span>
                                            </div>
                                        </div>


                                        <!-- Tabs -->
                                        <!-- Detailed Lists (Stacked) -->
                                        <div class="detailed-stats-section">
                                            <h6>Top Incidentes</h6>
                                            <div class="mini-stats-list" id="list-incidents-B1"></div>
                                        </div>

                                        <div class="detailed-stats-section" style="margin-top: 10px;">
                                            <h6>Acciones Frecuentes</h6>
                                            <div class="mini-stats-list" id="list-actions-B1"></div>
                                        </div>

                                        <button class="btn-filter-quadrant btn-sm" onclick="filterByQuadrant('B1')">
                                            <i class="fas fa-filter"></i> Filtrar cuadrante
                                        </button>
                                    </div>
                                </div>

                                <!-- Panel B3 -->
                                <div class="quadrant-info-panel" id="panel-B3" style="display:none;">
                                    <div class="info-panel-header">
                                        <span class="panel-quadrant-badge"
                                            style="background:#f1c40f; color:#333;">B3</span>
                                        <button class="panel-close" onclick="closeSpecificPanel('B3')">&times;</button>
                                    </div>
                                    <div class="info-panel-content">
                                        <div class="info-row">
                                            <div class="info-stat-compact">
                                                <div><i class="fas fa-exclamation-triangle"></i> Incidentes</div>
                                                <span class="stat-val" id="stat-incidents-B3">0</span>
                                            </div>
                                            <div class="info-stat-compact">
                                                <div><i class="fas fa-user-slash"></i> Indocumentados</div>
                                                <span class="stat-val" id="stat-undoc-B3">0</span>
                                            </div>
                                        </div>


                                        <!-- Detailed Lists (Stacked) -->
                                        <div class="detailed-stats-section">
                                            <h6>Top Incidentes</h6>
                                            <div class="mini-stats-list" id="list-incidents-B3"></div>
                                        </div>

                                        <div class="detailed-stats-section" style="margin-top: 10px;">
                                            <h6>Acciones Frecuentes</h6>
                                            <div class="mini-stats-list" id="list-actions-B3"></div>
                                        </div>

                                        <button class="btn-filter-quadrant btn-sm" onclick="filterByQuadrant('B3')">
                                            <i class="fas fa-filter"></i> Filtrar cuadrante
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Map Container (Center) -->
                            <div class="map-center-container">
                                <div class="quadrant-btn-container">
                                    <img src="MAPA CJB SEGURIDAD Cuadrantes.png" alt="Mapa de Cuadrantes CJB"
                                        class="security-map-image-small">
                                    <button class="quadrant-btn quadrant-b1"
                                        onclick="toggleQuadrantPanel('B1')">B1</button>
                                    <button class="quadrant-btn quadrant-b2"
                                        onclick="toggleQuadrantPanel('B2')">B2</button>
                                    <button class="quadrant-btn quadrant-b3"
                                        onclick="toggleQuadrantPanel('B3')">B3</button>
                                    <button class="quadrant-btn quadrant-b4"
                                        onclick="toggleQuadrantPanel('B4')">B4</button>
                                </div>
                            </div>

                            <!-- Right Panels Column (B2 & B4) -->
                            <div class="panels-column right-column">
                                <!-- Panel B2 -->
                                <div class="quadrant-info-panel" id="panel-B2" style="display:none;">
                                    <div class="info-panel-header">
                                        <span class="panel-quadrant-badge" style="background:#2ecc71;">B2</span>
                                        <button class="panel-close" onclick="closeSpecificPanel('B2')">&times;</button>
                                    </div>
                                    <div class="info-panel-content">
                                        <div class="info-row">
                                            <div class="info-stat-compact">
                                                <div><i class="fas fa-exclamation-triangle"></i> Incidentes</div>
                                                <span class="stat-val" id="stat-incidents-B2">0</span>
                                            </div>
                                            <div class="info-stat-compact">
                                                <div><i class="fas fa-user-slash"></i> Indocumentados</div>
                                                <span class="stat-val" id="stat-undoc-B2">0</span>
                                            </div>
                                        </div>


                                        <!-- Detailed Lists (Stacked) -->
                                        <div class="detailed-stats-section">
                                            <h6>Top Incidentes</h6>
                                            <div class="mini-stats-list" id="list-incidents-B2"></div>
                                        </div>

                                        <div class="detailed-stats-section" style="margin-top: 10px;">
                                            <h6>Acciones Frecuentes</h6>
                                            <div class="mini-stats-list" id="list-actions-B2"></div>
                                        </div>

                                        <button class="btn-filter-quadrant btn-sm" onclick="filterByQuadrant('B2')">
                                            <i class="fas fa-filter"></i> Filtrar cuadrante
                                        </button>
                                    </div>
                                </div>

                                <!-- Panel B4 -->
                                <div class="quadrant-info-panel" id="panel-B4" style="display:none;">
                                    <div class="info-panel-header">
                                        <span class="panel-quadrant-badge" style="background:#3498db;">B4</span>
                                        <button class="panel-close" onclick="closeSpecificPanel('B4')">&times;</button>
                                    </div>
                                    <div class="info-panel-content">
                                        <div class="info-row">
                                            <div class="info-stat-compact">
                                                <div><i class="fas fa-exclamation-triangle"></i> Incidentes</div>
                                                <span class="stat-val" id="stat-incidents-B4">0</span>
                                            </div>
                                            <div class="info-stat-compact">
                                                <div><i class="fas fa-user-slash"></i> Indocumentados</div>
                                                <span class="stat-val" id="stat-undoc-B4">0</span>
                                            </div>
                                        </div>


                                        <!-- Detailed Lists (Stacked) -->
                                        <div class="detailed-stats-section">
                                            <h6>Top Incidentes</h6>
                                            <div class="mini-stats-list" id="list-incidents-B4"></div>
                                        </div>

                                        <div class="detailed-stats-section" style="margin-top: 10px;">
                                            <h6>Acciones Frecuentes</h6>
                                            <div class="mini-stats-list" id="list-actions-B4"></div>
                                        </div>

                                        <button class="btn-filter-quadrant btn-sm" onclick="filterByQuadrant('B4')">
                                            <i class="fas fa-filter"></i> Filtrar cuadrante
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- Charts Row 1 -->
                <div class="charts-row">
                    <div class="chart-card chart-lg" data-chart="byType">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-bar"></i> Incidentes por Tipo</h3>
                            <span class="chart-filter-indicator" id="chartByTypeFilter"></span>
                        </div>
                        <p class="chart-description">üìä <strong>Qu√© muestra:</strong> Cantidad de incidentes
                            agrupados
                            por categor√≠a (Migraci√≥n, DIGESETT, Seguridad, etc.). <strong>Clic en una barra</strong>
                            para filtrar el dashboard por ese tipo.</p>
                        <div class="chart-body">
                            <canvas id="chartByType"></canvas>
                        </div>
                    </div>
                    <div class="chart-card chart-md" data-chart="byQuadrant">
                        <div class="chart-header">
                            <h3><i class="fas fa-map"></i> Distribuci√≥n por Cuadrante</h3>
                            <span class="chart-filter-indicator" id="chartByQuadrantFilter"></span>
                        </div>
                        <p class="chart-description">üó∫Ô∏è <strong>Qu√© muestra:</strong> Proporci√≥n de incidentes por
                            zona
                            geogr√°fica (cuadrantes B1, B2, B3, B4). <strong>Clic en un segmento</strong> para
                            filtrar
                            por zona.</p>
                        <div class="chart-body">
                            <canvas id="chartByQuadrant"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Charts Row 2 -->
                <div class="charts-row">
                    <div class="chart-card chart-full" data-chart="timeline">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-line"></i> Tendencia Temporal de Incidentes</h3>
                            <div class="chart-controls">
                                <button class="chart-btn active" data-period="daily">Diario</button>
                                <button class="chart-btn" data-period="weekly">Semanal</button>
                                <button class="chart-btn" data-period="monthly">Mensual</button>
                            </div>
                        </div>
                        <p class="chart-description">üìà <strong>Qu√© muestra:</strong> Evoluci√≥n del n√∫mero de
                            incidentes
                            a trav√©s del tiempo. <strong>Eje X:</strong> Fechas | <strong>Eje Y:</strong> Cantidad.
                            Use
                            los botones para cambiar la granularidad (Diario/Semanal/Mensual).</p>
                        <div class="chart-body chart-body-lg">
                            <canvas id="chartTimeline"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Charts Row 3 -->
                <div class="charts-row">
                    <div class="chart-card chart-md" data-chart="byOfficer">
                        <div class="chart-header">
                            <h3><i class="fas fa-user-shield"></i> Top 10 Oficiales por Incidentes</h3>
                            <span class="chart-filter-indicator" id="chartByOfficerFilter"></span>
                        </div>
                        <p class="chart-description">üëÆ <strong>Qu√© muestra:</strong> Los 10 oficiales con m√°s
                            incidentes atendidos. <strong>Clic en una barra</strong> para ver solo los incidentes de
                            ese
                            oficial espec√≠fico.</p>
                        <div class="chart-body">
                            <canvas id="chartByOfficer"></canvas>
                        </div>
                    </div>
                    <div class="chart-card chart-md" data-chart="actions">
                        <div class="chart-header">
                            <h3><i class="fas fa-gavel"></i> Acciones Tomadas</h3>
                            <span class="chart-filter-indicator" id="chartActionsFilter"></span>
                        </div>
                        <p class="chart-description">‚öñÔ∏è <strong>Qu√© muestra:</strong> Tipos de acciones realizadas
                            (Arresto, Advertencia, Clausura, etc.) y su frecuencia. <strong>Clic</strong> para
                            filtrar
                            por tipo de acci√≥n.</p>
                        <div class="chart-body">
                            <canvas id="chartActions"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Charts Row 4 -->
                <div class="charts-row">
                    <div class="chart-card chart-md" data-chart="undocByQuadrant">
                        <div class="chart-header">
                            <h3><i class="fas fa-passport"></i> Indocumentados por Cuadrante</h3>
                            <span class="chart-filter-indicator" id="chartUndocByQuadrantFilter"></span>
                        </div>
                        <p class="chart-description">üõÇ <strong>Qu√© muestra:</strong> Total de personas
                            indocumentadas
                            detenidas por zona. <strong>Eje X:</strong> Cuadrante | <strong>Eje Y:</strong> Cantidad
                            de
                            detenidos.</p>
                        <div class="chart-body">
                            <canvas id="chartUndocByQuadrant"></canvas>
                        </div>
                    </div>
                    <div class="chart-card chart-md" data-chart="byHour">
                        <div class="chart-header">
                            <h3><i class="fas fa-clock"></i> Incidentes por Hora del D√≠a</h3>
                            <span class="chart-filter-indicator" id="chartByHourFilter"></span>
                        </div>
                        <p class="chart-description">üïê <strong>Qu√© muestra:</strong> Distribuci√≥n horaria de
                            incidentes
                            (0:00 - 23:00). Identifique las horas pico de actividad. <strong>Clic en una
                                barra</strong>
                            para filtrar por hora.</p>
                        <div class="chart-body">
                            <canvas id="chartByHour"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Charts Row 5: Historical Data Integration -->
                <div class="charts-row">
                    <div class="chart-card chart-md" data-chart="multasHist">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-bar"></i> Multas por Semana (Hist√≥rico)</h3>
                            <span class="historical-badge"><i class="fas fa-history"></i> Jul-Dic 2025</span>
                        </div>
                        <p class="chart-description">üìä <strong>Qu√© muestra:</strong> Comparativa de multas DIGESETT
                            entre semanas hist√≥ricas.
                            <strong>Colores:</strong> üî¥ +150 | üü† 100-150 | üü¢ -100 multas.
                        </p>
                        <div class="chart-body">
                            <canvas id="chartMultasHist"></canvas>
                        </div>
                    </div>
                    <div class="chart-card chart-md" data-chart="migracionTrend">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-line"></i> Tendencia Migraci√≥n vs Multas</h3>
                            <span class="historical-badge"><i class="fas fa-history"></i> Jul-Dic 2025</span>
                        </div>
                        <p class="chart-description">üìà <strong>Qu√© muestra:</strong> Correlaci√≥n entre
                            indocumentados
                            detenidos y multas a lo largo del tiempo.
                            <strong>Nota:</strong> Multas escaladas (√∑10) para comparaci√≥n visual.
                        </p>
                        <div class="chart-body">
                            <canvas id="chartMigracionTrend"></canvas>
                        </div>
                    </div>
                </div>

            </div>
        </section>

        <!-- ================== INCIDENTS PAGE ================== -->
        <section class="page-section" id="incidentsPage" style="display: none;">
            <div class="dashboard-section">
                <!-- Quick Stats for Incidents -->
                <div class="quick-stats">
                    <div class="quick-stat">
                        <span class="quick-stat-value" id="incidentsTotal">0</span>
                        <span class="quick-stat-label">Total Registros</span>
                    </div>
                    <div class="quick-stat">
                        <span class="quick-stat-value" id="incidentsFiltered">0</span>
                        <span class="quick-stat-label">Filtrados</span>
                    </div>
                </div>

                <!-- Data Table Section -->
                <div class="table-section">
                    <div class="table-header">
                        <h3><i class="fas fa-table"></i> Registro de Incidentes</h3>
                        <div class="table-search">
                            <i class="fas fa-search"></i>
                            <input type="text" id="tableSearch" placeholder="Buscar incidente...">
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="data-table" id="incidentsTable">
                            <thead>
                                <tr>
                                    <th data-sort="id">ID <i class="fas fa-sort"></i></th>
                                    <th data-sort="date">Fecha <i class="fas fa-sort"></i></th>
                                    <th data-sort="type">Tipo <i class="fas fa-sort"></i></th>
                                    <th data-sort="quadrant">Cuadrante <i class="fas fa-sort"></i></th>
                                    <th data-sort="officer">Oficial <i class="fas fa-sort"></i></th>
                                    <th data-sort="undoc">Indocum. <i class="fas fa-sort"></i></th>
                                    <th>Narrativa</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="tableBody">
                            </tbody>
                        </table>
                    </div>
                    <div class="table-pagination">
                        <div class="pagination-info">
                            Mostrando <span id="paginationFrom">0</span> - <span id="paginationTo">0</span> de <span
                                id="paginationTotal">0</span>
                        </div>
                        <div class="pagination-controls">
                            <button class="pagination-btn" id="btnPrevPage" disabled>
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <span class="pagination-pages" id="paginationPages"></span>
                            <button class="pagination-btn" id="btnNextPage" disabled>
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        <div class="pagination-size">
                            <label>Por p√°gina:</label>
                            <select id="pageSize">
                                <option value="10">10</option>
                                <option value="25" selected>25</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ================== ANALYTICS PAGE ================== -->
        <section class="page-section" id="analyticsPage" style="display: none;">
            <div class="dashboard-section">
                <div class="analytics-header">
                    <h2><i class="fas fa-chart-line"></i> An√°lisis Avanzado</h2>
                    <p>Visualizaciones comparativas y an√°lisis detallado de patrones</p>
                </div>

                <!-- Comparative Charts -->
                <div class="charts-row">
                    <div class="chart-card chart-md">
                        <div class="chart-header">
                            <h3><i class="fas fa-calendar-week"></i> Incidentes por D√≠a de la Semana</h3>
                        </div>
                        <p class="chart-description">üìÖ <strong>Objetivo:</strong> Identificar qu√© d√≠as de la semana
                            tienen mayor actividad. <strong>Eje X:</strong> D√≠as (Dom-S√°b) | <strong>Eje Y:</strong>
                            Cantidad de incidentes. <strong>Clic</strong> para filtrar por d√≠a espec√≠fico.</p>
                        <div class="chart-body">
                            <canvas id="chartByDayOfWeek"></canvas>
                        </div>
                    </div>
                    <div class="chart-card chart-md">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-area"></i> Comparativa Mensual</h3>
                        </div>
                        <p class="chart-description">üìÜ <strong>Objetivo:</strong> Analizar tendencias y estacionalidad
                            a lo largo del a√±o. <strong>Eje X:</strong> Meses (Ene-Dic) | <strong>Eje Y:</strong> Total
                            de incidentes por mes. <strong>Clic</strong> para filtrar por mes.</p>
                        <div class="chart-body">
                            <canvas id="chartMonthlyComparison"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Heatmap like visualization -->
                <div class="charts-row">
                    <div class="chart-card chart-full">
                        <div class="chart-header">
                            <h3><i class="fas fa-th"></i> Patr√≥n de Actividad: Hora vs D√≠a</h3>
                        </div>
                        <p class="chart-description">üìä <strong>Objetivo:</strong> Visualizar en qu√© combinaci√≥n de d√≠a
                            y hora ocurren m√°s incidentes. <strong>Eje X:</strong> Horas del d√≠a (0-23) |
                            <strong>Colores:</strong> Cada color representa un d√≠a (Dom-S√°b) | <strong>Altura:</strong>
                            Cantidad acumulada. Las barras m√°s altas indican mayor actividad.
                        </p>
                        <div class="chart-body chart-body-lg">
                            <canvas id="chartHeatmap"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Officer Performance -->
                <div class="charts-row">
                    <div class="chart-card chart-full">
                        <div class="chart-header">
                            <h3><i class="fas fa-users"></i> Comparativa de Rendimiento por Oficial</h3>
                        </div>
                        <p class="chart-description">üëÆ‚Äç‚ôÇÔ∏è <strong>Objetivo:</strong> Comparar el desempe√±o de oficiales
                            seg√∫n incidentes atendidos vs indocumentados detenidos. <strong>Barras Azules:</strong>
                            Total de incidentes manejados | <strong>Barras Naranjas:</strong> Indocumentados detenidos.
                            Ordenado por mayor cantidad de detenciones.</p>
                        <div class="chart-body chart-body-lg">
                            <canvas id="chartOfficerPerformance"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ================== REPORTS PAGE ================== -->
        <section class="page-section" id="reportsPage" style="display: none;">
            <div class="dashboard-section">
                <div class="reports-header">
                    <h2><i class="fas fa-file-pdf"></i> Centro de Reportes</h2>
                    <p>Genera y exporta reportes personalizados</p>
                </div>

                <div class="reports-grid">
                    <div class="report-card" id="reportIncidents">
                        <div class="report-icon">
                            <i class="fas fa-file-excel"></i>
                        </div>
                        <h3>Reporte de Incidentes</h3>
                        <p>Exporta todos los incidentes filtrados a Excel</p>
                        <button class="btn btn-primary" onclick="exportToExcel()">
                            <i class="fas fa-download"></i> Descargar Excel
                        </button>
                    </div>

                    <div class="report-card" id="reportSummary">
                        <div class="report-icon">
                            <i class="fas fa-clipboard-list"></i>
                        </div>
                        <h3>Resumen Ejecutivo</h3>
                        <p>Reporte resumido con KPIs principales</p>
                        <button class="btn btn-primary" onclick="generateExecutiveSummary()">
                            <i class="fas fa-eye"></i> Ver Resumen
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- History Page -->
        <section class="page-section" id="historyPage" style="display: none;">
            <div class="dashboard-section">
                <div class="section-header">
                    <div>
                        <h2><i class="fas fa-history"></i> Hist√≥rico de Reportes</h2>
                        <p>Registro manual de datos hist√≥ricos para visualizaci√≥n comparativa. Los datos se guardan en
                            su navegador.</p>
                    </div>
                </div>

                <div class="history-grid">
                    <!-- KPI Summary Cards -->
                    <div class="history-kpi-row">
                        <div class="history-kpi-card">
                            <div class="kpi-icon-sm" style="background: rgba(243, 156, 18, 0.15); color: #f39c12;">
                                <i class="fas fa-passport"></i>
                            </div>
                            <div class="kpi-data">
                                <span class="kpi-number" id="kpiTotalMigracion">0</span>
                                <span class="kpi-label-sm">Migraci√≥n Total</span>
                            </div>
                        </div>
                        <div class="history-kpi-card">
                            <div class="kpi-icon-sm" style="background: rgba(231, 76, 60, 0.15); color: #e74c3c;">
                                <i class="fas fa-ticket-alt"></i>
                            </div>
                            <div class="kpi-data">
                                <span class="kpi-number" id="kpiTotalMultas">0</span>
                                <span class="kpi-label-sm">Multas Total</span>
                            </div>
                        </div>
                        <div class="history-kpi-card">
                            <div class="kpi-icon-sm" style="background: rgba(52, 152, 219, 0.15); color: #3498db;">
                                <i class="fas fa-phone"></i>
                            </div>
                            <div class="kpi-data">
                                <span class="kpi-number" id="kpiTotalLlamadas">0</span>
                                <span class="kpi-label-sm">Llamadas Total</span>
                            </div>
                        </div>
                        <div class="history-kpi-card">
                            <div class="kpi-icon-sm" style="background: rgba(155, 89, 182, 0.15); color: #9b59b6;">
                                <i class="fas fa-car-crash"></i>
                            </div>
                            <div class="kpi-data">
                                <span class="kpi-number" id="kpiTotalAccidentes">0</span>
                                <span class="kpi-label-sm">Accidentes Total</span>
                            </div>
                        </div>
                        <div class="history-kpi-card">
                            <div class="kpi-icon-sm" style="background: rgba(46, 204, 113, 0.15); color: #2ecc71;">
                                <i class="fas fa-hands-helping"></i>
                            </div>
                            <div class="kpi-data">
                                <span class="kpi-number" id="kpiTotalAsistencias">0</span>
                                <span class="kpi-label-sm">Asistencias Total</span>
                            </div>
                        </div>
                    </div>

                    <!-- MAIN CHART: Timeline Evolution -->
                    <div class="history-card chart-main">
                        <div class="card-header">
                            <h3><i class="fas fa-chart-area"></i> Evoluci√≥n Temporal (Julio - Diciembre 2025)</h3>
                        </div>
                        <div class="chart-description">
                            <strong>Objetivo:</strong> Visualizar c√≥mo cambian los incidentes a lo largo del tiempo.
                            <strong>Medici√≥n:</strong> Cantidad de eventos por semana ordenados cronol√≥gicamente.
                            <strong>Interpretaci√≥n:</strong> L√≠neas ascendentes = aumento; descendentes = disminuci√≥n.
                        </div>
                        <div class="history-chart-container" style="position: relative; height: 350px; width: 100%;">
                            <canvas id="historyTimelineChart"></canvas>
                        </div>
                    </div>

                    <!-- Secondary Charts Row -->
                    <div class="history-card">
                        <div class="card-header">
                            <h3><i class="fas fa-chart-bar"></i> Comparativa de Multas por Semana</h3>
                        </div>
                        <div class="chart-description">
                            <strong>Objetivo:</strong> Comparar multas entre semanas. <strong>Colores:</strong> üî¥ +150
                            multas | üü† 100-150 | üü¢ -100.
                        </div>
                        <div class="history-chart-container" style="position: relative; height: 280px; width: 100%;">
                            <canvas id="historyMultasChart"></canvas>
                        </div>
                    </div>

                    <div class="history-card">
                        <div class="card-header">
                            <h3><i class="fas fa-chart-pie"></i> Distribuci√≥n Total por Categor√≠a</h3>
                        </div>
                        <div class="chart-description">
                            <strong>Objetivo:</strong> Ver qu√© tipo de incidente es m√°s frecuente.
                            <strong>Medici√≥n:</strong> Porcentaje del total acumulado.
                        </div>
                        <div class="history-chart-container" style="position: relative; height: 280px; width: 100%;">
                            <canvas id="historyPieChart"></canvas>
                        </div>
                    </div>

                    <!-- Radar Chart for Pattern Analysis -->
                    <div class="history-card">
                        <div class="card-header">
                            <h3><i class="fas fa-spider"></i> An√°lisis de Patrones por Mes</h3>
                        </div>
                        <div class="chart-description">
                            <strong>Objetivo:</strong> Comparar el "perfil" de cada mes. <strong>Medici√≥n:</strong> Cada
                            eje representa una categor√≠a diferente. <strong>Nota:</strong> Multas est√°n escaladas (√∑10)
                            para mejor visualizaci√≥n.
                        </div>
                        <div class="history-chart-container" style="position: relative; height: 280px; width: 100%;">
                            <canvas id="historyRadarChart"></canvas>
                        </div>
                    </div>

                    <div class="history-card">
                        <div class="card-header">
                            <h3><i class="fas fa-chart-line"></i> Tendencia Migraci√≥n vs Multas</h3>
                        </div>
                        <div class="chart-description">
                            <strong>Objetivo:</strong> Correlacionar migraci√≥n con multas. <strong>Medici√≥n:</strong>
                            Multas escaladas (√∑10) para poder comparar visualmente con migraci√≥n.
                        </div>
                        <div class="history-chart-container" style="position: relative; height: 280px; width: 100%;">
                            <canvas id="historyTrendChart"></canvas>
                        </div>
                    </div>

                    <!-- Data Management Section (Less Prominent) -->
                    <div class="history-card data-management-card">
                        <div class="card-header collapsible" onclick="toggleDataSection()">
                            <h3><i class="fas fa-database"></i> Gesti√≥n de Datos</h3>
                            <button class="btn btn-sm btn-secondary">
                                <i class="fas fa-chevron-down" id="dataSectionIcon"></i>
                            </button>
                        </div>
                        <div class="data-management-content" id="dataManagementContent">
                            <!-- PDF Files List -->
                            <div class="pdf-section">
                                <h4><i class="fas fa-folder-open"></i> Archivos PDF Hist√≥ricos</h4>
                                <p class="pdf-files-instruction">
                                    <i class="fas fa-info-circle"></i>
                                    Haz clic en <i class="fas fa-external-link-alt"></i> para abrir o <i
                                        class="fas fa-edit"></i> para editar datos.
                                </p>
                                <div class="pdf-files-list" id="pdfFilesList">
                                    <div class="pdf-files-loading">
                                        <i class="fas fa-spinner fa-spin"></i> Cargando...
                                    </div>
                                </div>
                            </div>
                            <!-- Data Table -->
                            <div class="table-section-mini">
                                <h4><i class="fas fa-table"></i> Tabla de Datos</h4>
                                <div class="history-data-table-container">
                                    <table class="history-data-table" id="historyDataTable">
                                        <thead>
                                            <tr>
                                                <th>Per√≠odo</th>
                                                <th>Migraci√≥n</th>
                                                <th>Multas</th>
                                                <th>Motos</th>
                                                <th>Llamadas</th>
                                                <th>Accidentes</th>
                                                <th>Asistencias</th>
                                                <th>Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody id="historyTableBody">
                                        </tbody>
                                    </table>
                                </div>
                                <div class="history-table-footer">
                                    <button class="btn btn-secondary btn-sm" onclick="clearAllHistoryData()">
                                        <i class="fas fa-trash"></i> Limpiar
                                    </button>
                                    <button class="btn btn-primary btn-sm" onclick="exportHistoryData()">
                                        <i class="fas fa-download"></i> Exportar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Incident Detail Modal -->
        <div class="modal" id="incidentModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-file-alt"></i> Detalle del Incidente #<span id="modalIncidentId"></span></h3>
                    <button class="modal-close" id="btnCloseModal">&times;</button>
                </div>
                <div class="modal-body" id="modalBody">
                </div>
            </div>
        </div>

        <!-- Executive Summary Modal -->
        <div class="modal" id="summaryModal">
            <div class="modal-content modal-lg">
                <div class="modal-header">
                    <h3><i class="fas fa-clipboard-list"></i> Resumen Ejecutivo</h3>
                    <button class="modal-close" onclick="closeSummaryModal()">&times;</button>
                </div>
                <div class="modal-body" id="summaryModalBody">
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="printSummary()">
                        <i class="fas fa-print"></i> Imprimir
                    </button>
                    <button class="btn btn-secondary" onclick="closeSummaryModal()">
                        Cerrar
                    </button>
                </div>
            </div>
        </div>

        <!-- Manual Data Entry Modal -->
        <div class="modal" id="manualDataModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-edit"></i> Ingresar Datos Manuales</h3>
                    <button class="modal-close" onclick="closeManualDataModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <p id="modalReportName" class="mb-4 text-muted"></p>
                    <input type="hidden" id="modalReportId">

                    <div class="form-grid">
                        <div class="form-group">
                            <label><i class="fas fa-users"></i> Haitianos Entregados (Migraci√≥n)</label>
                            <input type="number" id="inputHaitianos" class="form-control" min="0" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-ticket-alt"></i> Multas de Tr√°nsito</label>
                            <input type="number" id="inputMultas" class="form-control" min="0" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-motorcycle"></i> Motocicletas Retenidas</label>
                            <input type="number" id="inputMotos" class="form-control" min="0" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-phone"></i> Llamadas Ciudadanas</label>
                            <input type="number" id="inputLlamadas" class="form-control" min="0" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-car-crash"></i> Accidentes Tr√°nsito</label>
                            <input type="number" id="inputAccidentes" class="form-control" min="0" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-hand-holding-medical"></i> Asistencias Seguridad</label>
                            <input type="number" id="inputAsistencias" class="form-control" min="0" placeholder="0">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" onclick="saveManualData()">
                        <i class="fas fa-save"></i> Guardar y Actualizar Gr√°ficas
                    </button>
                    <button class="btn btn-secondary" onclick="closeManualDataModal()">
                        Cancelar
                    </button>
                </div>
            </div>
        </div>

    </main>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Procesando datos...</p>
        </div>
    </div>

    <!-- Custom Scripts -->
    <script src="app.js"></script>
</body>

</html>